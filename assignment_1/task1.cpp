#include <iostream>   // Подключение библиотеки для ввода и вывода (std::cout, std::endl)
#include <cstdlib>    // Подключение библиотеки для функций rand() и srand()
#include <ctime>      // Подключение библиотеки для получения текущего времени (time)
#include <omp.h>      // Подключение библиотеки OpenMP для параллельных вычислений

#ifdef _WIN32        // Проверка: если программа компилируется под Windows
#include <windows.h> // Подключение заголовка Windows API
#endif               // Конец условной компиляции

int main() {          // Точка входа в программу

#ifdef _WIN32
    // Устанавливает кодировку UTF-8 для вывода в консоль Windows
    SetConsoleOutputCP(CP_UTF8);

    // Устанавливает кодировку UTF-8 для ввода с клавиатуры в консоль Windows
    SetConsoleCP(CP_UTF8);
#endif

    // Размер динамического массива
    const int SIZE = 50000;

    // Динамическое выделение памяти под массив из SIZE целых чисел
    int* array = new int[SIZE];

    // Инициализация генератора случайных чисел текущим временем
    std::srand(static_cast<unsigned>(std::time(nullptr)));

    // Параллельный цикл OpenMP для заполнения массива случайными числами
    // Каждый поток заполняет свою часть массива
    #pragma omp parallel for
    for (int i = 0; i < SIZE; i++) {
        // Генерация случайного числа в диапазоне от 1 до 100
        array[i] = std::rand() % 100 + 1;
    }

    // Переменная для хранения суммы элементов массива
    // long long используется для предотвращения переполнения
    long long sum = 0;

    // Параллельный цикл OpenMP для вычисления суммы элементов массива
    // reduction(+:sum) обеспечивает корректное сложение из разных потоков
    #pragma omp parallel for reduction(+:sum)
    for (int i = 0; i < SIZE; i++) {
        // Добавление текущего элемента массива к общей сумме
        sum += array[i];
    }

    // Вычисление среднего значения элементов массива
    // Приведение к double необходимо для получения дробного результата
    double average = static_cast<double>(sum) / SIZE;

    // Вывод результата на экран (строка в кодировке UTF-8)
    std::cout << u8"Среднее значение элементов массива: "
              << average << std::endl;

    // Освобождение ранее выделенной динамической памяти
    delete[] array;

    // Завершение программы без ошибок
    return 0;
}
